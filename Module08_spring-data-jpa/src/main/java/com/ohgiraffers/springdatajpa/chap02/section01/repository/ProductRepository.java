package com.ohgiraffers.springdatajpa.chap02.section01.repository;

import com.ohgiraffers.springdatajpa.common.Product;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;


/*
 * =====================================================================================
 * π€ Section 01: JpaRepository μΈν„°νμ΄μ¤μ™€ μλ™ κµ¬ν„
 * =====================================================================================
 */

/*
 * [ν•™μµμ νƒ€μ΄ν•‘μ© βοΈ]
 * 1. Repository μΈν„°νμ΄μ¤: λ°μ΄ν„° μ ‘κ·Όμ 'μ¶”μƒν™”'
 * - DB μ‘μ—…μ μƒμ„Έ κµ¬ν„(SQL, JDBC)μ„ μ¨κΈ°κ³ , 'λ¬΄μ—‡μ„ ν• μ§€(What)'λ§ μ •μν• λ…μ„Έμ…λ‹λ‹¤.
 * - μ΄ μΈν„°νμ΄μ¤λ” 'ν΄λμ¤'κ°€ μ•„λ‹ 'μΈν„°νμ΄μ¤'λ΅ μ •μν•©λ‹λ‹¤.
 *
 * 2. JpaRepository<T, ID> μƒμ†
 * - Spring Data JPAκ°€ μ κ³µν•λ” μΈν„°νμ΄μ¤λ¥Ό μƒμ†λ°›μµλ‹λ‹¤.
 * - <T>: κ΄€λ¦¬ν•  'μ—”ν‹°ν‹°(Entity)' ν΄λμ¤ (μ: Product)
 * - <ID>: ν•΄λ‹Ή μ—”ν‹°ν‹°μ '@Id' ν•„λ“ 'νƒ€μ…' (μ: Integer, Long)
 *
 * 3. π’΅ ν•µμ‹¬: μλ™ κµ¬ν„ (Auto-Implementation)
 * - κ°λ°μλ” μ΄ μΈν„°νμ΄μ¤μ 'κµ¬ν„ ν΄λμ¤(Impl)'λ¥Ό λ§λ“¤μ§€ μ•μµλ‹λ‹¤.
 * - Spring Data JPAκ°€ μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ μ‹μ μ— 'μλ™μΌλ΅' κµ¬ν„ κ°μ²΄λ¥Ό μƒμ„±ν•μ—¬
 * μ¤ν”„λ§ BeanμΌλ΅ λ“±λ΅ν•΄ μ¤λ‹λ‹¤.
 *
 * 4. κΈ°λ³Έ κΈ°λ¥ μ¦‰μ‹ μ‚¬μ©
 * - JpaRepositoryλ¥Ό μƒμ†λ°›λ” κ²ƒλ§μΌλ΅, λ‹¤μκ³Ό κ°™μ€ ν•µμ‹¬ λ©”μ„λ“λ¥Ό 'λ¬΄λ£λ΅' μ–»κ² λ©λ‹λ‹¤.
 * - save(T): C(μ €μ¥), U(μμ •)
 * - findById(ID): R(λ‹¨κ±΄ μ΅°ν)
 * - findAll(): R(μ „μ²΄ μ΅°ν)
 * - delete(T): D(μ‚­μ )
 * - (μ¶”κ°€) νμ΄μ§•(Pageable) λ° μ •λ ¬(Sort) κΈ°λ¥
 *
 * 5. @Repository μ–΄λ…Έν…μ΄μ…
 * - (1) μ΄ μΈν„°νμ΄μ¤κ°€ λ°μ΄ν„° μ ‘κ·Ό 'μ»΄ν¬λ„νΈ(Bean)'μ„μ„ λ…μ‹ν•©λ‹λ‹¤.
 * - (2) Spring Data JPAμ μ¤μΊ” λ€μƒμ΄ λμ–΄ 'μλ™ κµ¬ν„'μ„ ν™μ„±ν™”ν•©λ‹λ‹¤.
 * - (3) JPA μμ™Έλ¥Ό μ¤ν”„λ§μ 'DataAccessException'μΌλ΅ 'μλ™ λ³€ν™'ν•΄μ¤λ‹λ‹¤.
 */

/*
 * =====================================================================================
 * [κµμμ μ„¤λ…μ© π‘¨β€π«]
 * =====================================================================================
 *
 * 1. π† μ΄κ²ƒμ΄ μ™ νλ…μΈκ°€? (Boilerplate μ½”λ“μ μ™„μ „ν• μ κ±°)
 *
 * - [κ³Όκ±°] Section 02μ—μ„ λ³Έ κ²ƒμ²λΌ, μμ JPA(EntityManager)λ¥Ό μ‚¬μ©ν•λ©΄
 * κ°λ°μκ°€ `ProductRepositoryImpl` κ°™μ€ 'κµ¬ν„ ν΄λμ¤'λ¥Ό μ§μ ‘ λ§λ“¤μ–΄μ•Ό ν–μµλ‹λ‹¤.
 * - [κ³Όκ±°μ λ¬Έμ ] κ·Έ κµ¬ν„ ν΄λμ¤ μ•μ—λ” `em.persist()`, `em.find()`, `em.createQuery()` λ“±
 * EntityManagerλ¥Ό μ‚¬μ©ν• λ°λ³µμ μ΄κ³  μ§€λ£¨ν• 'λ³΄μΌλ¬ν”λ μ΄νΈ μ½”λ“'κ°€ κ°€λ“ν–μµλ‹λ‹¤.
 *
 * - [ν„μ¬ (Spring Data JPA)]
 * μ΄μ  κ°λ°μλ” 'μΈν„°νμ΄μ¤'λ§ μ •μν•λ©΄ λμ…λ‹λ‹¤.
 * `save`, `findById` κ°™μ€ κ³µν†µ CRUD λ©”μ„λ“ κµ¬ν„μ€ 100% Spring Data JPAμ— 'μ„μ„'ν•©λ‹λ‹¤.
 *
 * - [λΉ„μ ]
 * - κ³Όκ±°(EntityManager): μ‹λ‹Ήμ—μ„ 'μ§μ ‘' μ£Όλ°©μ— λ“¤μ–΄κ°€('em' νλ“),
 * μ¬λ£λ¥Ό μ†μ§ν•κ³ ('em.persist'), μ”λ¦¬ν•κ³ (νΈλμ­μ… μ²λ¦¬), μ„¤κ±°μ§€('em.close')κΉμ§€ ν–μµλ‹λ‹¤.
 * - ν„μ¬(JpaRepository): μ‹λ‹Ήμ 'ν‚¤μ¤μ¤ν¬(μΈν„°νμ΄μ¤)'μ—μ„ 'μ£Όλ¬Έ(λ©”μ„λ“ νΈμ¶)'λ§ ν•©λ‹λ‹¤.
 * μ£Όλ°©(Spring Data JPA)μ—μ„ μ”λ¦¬(κµ¬ν„)κ°€ μλ™μΌλ΅ μ™„λ£λμ–΄ λ‚μµλ‹λ‹¤.
 *
 * -------------------------------------------------------------------------------------
 *
 * 2. π¤” μ–΄λ–»κ² κ°€λ¥ν•κ°€? (μλ™ κµ¬ν„μ λ‚΄λ¶€ μ›λ¦¬)
 *
 * μ΄ 'μλ™ κµ¬ν„'μ€ Springμ 'ν”„λ΅μ‹(Proxy)' κΈ°μ μ„ κΈ°λ°μΌλ΅ λ™μ‘ν•©λ‹λ‹¤.
 *
 * 1. (μ‹μ‘) μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‹μ‘λλ©΄, Spring Data JPAκ°€ `@Repository`κ°€ λ¶™κ³ 
 * `JpaRepository`λ¥Ό μƒμ†ν• 'μΈν„°νμ΄μ¤'λ“¤μ„ μ¤μΊ”ν•©λ‹λ‹¤.
 *
 * 2. (ν”„λ΅μ‹ μƒμ„±) ν•΄λ‹Ή μΈν„°νμ΄μ¤(μ: `ProductRepository`)λ¥Ό κΈ°λ°μΌλ΅,
 * Springμ€ 'κ°€μ§ κµ¬ν„ κ°μ²΄(Dynamic Proxy)'λ¥Ό 'λ©”λ¨λ¦¬μƒ'μ— λ™μ μΌλ΅ μƒμ„±ν•©λ‹λ‹¤.
 * (μ‹¤μ  .java νμΌμ΄ μƒμ„±λλ” κ²ƒμ΄ μ•„λ‹™λ‹λ‹¤.)
 *
 * 3. (Bean λ“±λ΅) μ΄ 'ν”„λ΅μ‹ κ°μ²΄'λ¥Ό μ‹¤μ  κµ¬ν„μ²΄μ²λΌ μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— 'Bean'μΌλ΅ λ“±λ΅ν•©λ‹λ‹¤.
 *
 * 4. (μ‹¤ν–‰) μ„λΉ„μ¤ κ³„μΈµμ—μ„ `productRepository.save(product)`λ¥Ό νΈμ¶ν•λ©΄,
 * μ‹¤μ λ΅λ” μ΄ 'ν”„λ΅μ‹ κ°μ²΄'μ `save` λ©”μ„λ“κ°€ νΈμ¶λ©λ‹λ‹¤.
 *
 * 5. (μ„μ„) ν”„λ΅μ‹ κ°μ²΄λ” λ‚΄λ¶€μ μΌλ΅ 'AOP(κ΄€μ  μ§€ν–¥ ν”„λ΅κ·Έλλ°)'λ¥Ό ν†µν•΄,
 * νΈμ¶λ λ©”μ„λ“λ…(`save`)μ„ λ¶„μ„ν•μ—¬, μμ‹ μ΄ μ¨κΈ°κ³  μλ 'EntityManager'λ¥Ό κΊΌλ‚΄
 * `em.persist(product)`λΌλ” μ‹¤μ  JPA λ΅μ§μ„ 'λ€μ‹ ' μ‹¤ν–‰ν•΄ μ¤λ‹λ‹¤.
 *
 * -------------------------------------------------------------------------------------
 *
 * 3. `JpaRepository<Product, Integer>` (μ λ„¤λ¦­μ μ¤‘μ”μ„±)
 *
 * - `<T, ID>` μ΄ μ λ„¤λ¦­ νƒ€μ…μ€ Spring Data JPAμ ν”„λ΅μ‹μ—κ² λ§¤μ° μ¤‘μ”ν• 'μ •λ³΄'λ¥Ό μ κ³µν•©λ‹λ‹¤.
 * - `<Product>`: "μ΄ λ¦¬ν¬μ§€ν† λ¦¬λ” 'Product' μ—”ν‹°ν‹°λ¥Ό κ΄€λ¦¬ν•©λ‹λ‹¤.
 * `findAll()`μ„ νΈμ¶ν•λ©΄ `SELECT p FROM Product p`λ¥Ό μ‹¤ν–‰ν•΄μ•Ό ν•©λ‹λ‹¤."
 * - `<Integer>`: "Product μ—”ν‹°ν‹°μ `@Id` νƒ€μ…μ€ 'Integer'μ…λ‹λ‹¤.
 * `findById(10)`μ΄ νΈμ¶λλ©΄, `em.find(Product.class, 10)`μ„ μ‹¤ν–‰ν•΄μ•Ό ν•©λ‹λ‹¤."
 *
 * - λ§μ•½ μ λ„¤λ¦­μ„ μλ» μ§€μ •ν•λ©΄(μ: `<Product, String>`), ν”„λ΅μ‹λ” μ—‰λ±ν• νƒ€μ…μΌλ΅
 * IDλ¥Ό μ΅°νν•λ ¤λ‹¤ λ°νƒ€μ„μ— μ‹¬κ°ν• μ¤λ¥λ¥Ό λ°μƒμ‹ν‚µλ‹λ‹¤.
 *
 * -------------------------------------------------------------------------------------
 *
 * 4. π“ @Repository μ–΄λ…Έν…μ΄μ…μ μ‹¬μΈµμ  μ—­ν• 
 *
 * "JpaRepositoryλ¥Ό μƒμ†ν•λ©΄ μ–΄μ°¨ν”Ό μ¤μΊ”λλ”λ°, @Repositoryλ” μ™ λ¶™μ΄λ‚μ”?"
 *
 * - (1) λ…μ‹μ  μ»΄ν¬λ„νΈ μ„ μ–Έ (κ΄€λ΅€):
 * `@Service`, `@Controller`μ™€ λ§μ°¬κ°€μ§€λ΅, μ΄ μΈν„°νμ΄μ¤κ°€ 'λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµ'μ
 * μ»΄ν¬λ„νΈ(Bean)μ„μ„ λ…ν™•ν λ“λ¬λ‚΄λ” 'κ΄€λ΅€μ (Idiomatic)'μΈ ν‘ν„μ…λ‹λ‹¤.
 * κ°€λ…μ„±κ³Ό λ…μ‹μ„±μ„ λ†’μ—¬μ¤λ‹λ‹¤. (κΈ°μ μ μΌλ΅λ” `@EnableJpaRepositories` μ„¤μ •μ΄
 * μ¤μΊ”μ„ μν–‰ν•λ―€λ΅ μƒλµ κ°€λ¥ν•  λ•λ„ μμ§€λ§, λ¶™μ΄λ” κ²ƒμ„ κ¶μ¥ν•©λ‹λ‹¤.)
 *
 * - (2) μμ™Έ λ³€ν™ (Exception Translation) β­οΈ
 * μ΄ κΈ°λ¥μ€ 'Section 02(EntityManager)'μ—μ„ μ„¤λ…ν• κ²ƒκ³Ό λ™μΌν•κ²,
 * Spring Data JPAκ°€ μƒμ„±ν• 'ν”„λ΅μ‹ κµ¬ν„μ²΄'μ—λ„ μ μ©λ©λ‹λ‹¤.
 *
 * - [λ™μ‘] `save()` νΈμ¶ μ‹ DBμ—μ„ μ λ‹ν¬ μ μ•½μ΅°κ±΄ μ„λ°(Unique Constraint Violation)μ΄
 * λ°μƒν–λ‹¤κ³  κ°€μ •ν•΄ λ΄…μ‹λ‹¤.
 * 1. Hibernate(JPA)κ°€ `PersistenceException` (λλ” ν•μ„ μμ™Έ)λ¥Ό λμ§‘λ‹λ‹¤.
 * 2. @Repositoryμ 'μμ™Έ λ³€ν™ AOP'κ°€ μ΄ μμ™Έλ¥Ό κ°€λ΅μ±•λ‹λ‹¤.
 * 3. μ΄ μμ™Έλ¥Ό λ¶„μ„ν•μ—¬, μ¤ν”„λ§μ μΌκ΄€λ μμ™ΈμΈ `DataIntegrityViolationException`
 * (DataAccessExceptionμ ν•μ„ μμ™Έ)μΌλ΅ 'λ³€ν™'ν•μ—¬ λ‹¤μ‹ λμ§‘λ‹λ‹¤.
 *
 * - [μ¥μ ] μ„λΉ„μ¤ κ³„μΈµ(`@Service`)μ€ JPAλ‚ Hibernateμ νΉμ • μμ™Έλ¥Ό μ• ν•„μ”κ°€ μ—†μ–΄μ§‘λ‹λ‹¤.
 * μ¤μ§ μ¤ν”„λ§μ `DataAccessException`λ§ μ²λ¦¬ν•λ©΄ λλ―€λ΅,
 * λ°μ΄ν„° κΈ°μ (JPA, JDBC, MyBatis λ“±)λ΅λ¶€ν„° 'μ™„μ „ν λ¶„λ¦¬(decoupled)'λ©λ‹λ‹¤.
 */
@Repository("chap01-section01-repository")
public interface ProductRepository extends JpaRepository<Product, Integer> {
    // β¨ λΉ„μ–΄μμ–΄λ„ κ΄μ°®μµλ‹λ‹¤! β¨
    // κΈ°λ³Έμ μΈ CRUD λ©”μ„λ“λ” μ΄λ―Έ JpaRepository μΈν„°νμ΄μ¤μ— λ¨λ‘ μ •μλμ–΄ μμµλ‹λ‹¤.
    // - save(S entity): μ—”ν‹°ν‹° μ €μ¥ (Insert or Update)
    // - findById(ID id): IDλ΅ μ—”ν‹°ν‹° μ΅°ν (Optional<T> λ°ν™)
    // - findAll(): λ¨λ“  μ—”ν‹°ν‹° μ΅°ν (List<T> λ°ν™)
    // - deleteById(ID id): IDλ΅ μ—”ν‹°ν‹° μ‚­μ 
    // - count(): μ „μ²΄ μ—”ν‹°ν‹° κ°μ μ΅°ν
    // - existsById(ID id): ν•΄λ‹Ή IDμ μ—”ν‹°ν‹° μ΅΄μ¬ μ—¬λ¶€ ν™•μΈ
    // ... λ“±λ“± (λ” λ§μ€ λ©”μ„λ“λ” JpaRepository λ¬Έμ„λ¥Ό μ°Έκ³ ν•μ„Έμ”!)

    // π’΅ λ§μ•½ Product μ—”ν‹°ν‹°μ—λ§ νΉν™”λ μ΅°ν λ©”μ„λ“κ°€ ν•„μ”ν•λ‹¤λ©΄?
    // -> Chap 03μ—μ„ λ°°μΈ 'μΏΌλ¦¬ λ©”μ†λ“' λλ” '@Query'λ¥Ό μ‚¬μ©ν•μ—¬ μ—¬κΈ°μ— μ§μ ‘ μ„ μ–Έν•  μ μμµλ‹λ‹¤.
    // μ: List<Product> findByProductNameContaining(String namePart);
}
