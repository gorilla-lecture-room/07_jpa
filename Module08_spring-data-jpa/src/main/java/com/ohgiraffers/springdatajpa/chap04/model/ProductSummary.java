package com.ohgiraffers.springdatajpa.chap04.model;

/*
 * =====================================================================================
 * π“ 5λ² μμ : μΈν„°νμ΄μ¤ κΈ°λ° ν”„λ΅μ μ…(Interface-Based Projection) μ •μ
 * =====================================================================================
 */

/*
 * [ν•™μµμ νƒ€μ΄ν•‘μ© βοΈ]
 *
 * 1. ν”„λ΅μ μ…(Projection)μ΄λ€?
 * - μ—”ν‹°ν‹°(Entity)μ 'μ „μ²΄' ν•„λ“κ°€ μ•„λ‹, 'μΌλ¶€ νΉμ • ν•„λ“'λ§ μ„ νƒν•μ—¬
 * μ΅°ν(SELECT)ν•λ” κΈ°μ μ…λ‹λ‹¤. (μ: 20κ° ν•„λ“ μ¤‘ 2κ°λ§ μ΅°ν)
 *
 * 2. μΈν„°νμ΄μ¤ κΈ°λ° ν”„λ΅μ μ… (Interface-Based Projection)
 * - μ΅°νν•  ν•„λ“λ“¤μ 'getter' λ©”μ„λ“ μ‹κ·Έλ‹μ²λ§ ν¬ν•¨ν•λ” 'μΈν„°νμ΄μ¤'λ¥Ό μ •μν•λ” λ°©μ‹μ…λ‹λ‹¤.
 *
 * 3. μ‘μ„± κ·μΉ™
 * - (1) μΈν„°νμ΄μ¤λ΅ μ„ μ–Έν•©λ‹λ‹¤. (μ: `interface ProductSummary`)
 * - (2) μ΅°νν•λ ¤λ” μ—”ν‹°ν‹°μ 'ν•„λ“λ…'κ³Ό 'μ •ν™•ν μΌμΉ'ν•λ” 'getter' λ©”μ„λ“λ¥Ό μ •μν•©λ‹λ‹¤.
 * - (μ: μ—”ν‹°ν‹°μ `productId` ν•„λ“ -> `getProductId()`)
 * - (μ: μ—”ν‹°ν‹°μ `productName` ν•„λ“ -> `getProductName()`)
 *
 * 4. μ‚¬μ©λ²•
 * - μ΄ μΈν„°νμ΄μ¤(`ProductSummary`)λ¥Ό JpaRepository μΏΌλ¦¬ λ©”μ†λ“μ 'λ°ν™ νƒ€μ…'μΌλ΅
 * μ‚¬μ©ν•©λ‹λ‹¤.
 * - (μ: `List<ProductSummary> findByName(String name);`)
 *
 * 5. μ¥μ 
 * - 'SELECT *'κ°€ μ•„λ‹ 'SELECT id, name'μ²λΌ μµμ ν™”λ μΏΌλ¦¬κ°€ μ‹¤ν–‰λ©λ‹λ‹¤.
 * - μ „μ²΄ μ—”ν‹°ν‹°κ°€ μ•„λ‹ κ°€λ²Όμ΄ 'DTO(Data Transfer Object)'λ¥Ό λ°ν™λ°›μ•„
 * λ„¤νΈμ›ν¬, λ©”λ¨λ¦¬, CPU μ„±λ¥μ„ ν–¥μƒμ‹ν‚µλ‹λ‹¤.
 */

/*
 * =====================================================================================
 * [κµμμ μ„¤λ…μ© π‘¨β€π«]
 * =====================================================================================
 *
 * 1. β“ μ™ ν”„λ΅μ μ…μ΄ ν•„μ”ν•κ°€? (Over-fetching λ¬Έμ )
 *
 * - [λ¬Έμ ] λ§μ•½ `Product` μ—”ν‹°ν‹°μ— 20κ°μ ν•„λ“(id, name, price, stock, description,
 * createdAt, modifiedAt, etc...)κ°€ μλ‹¤κ³  κ°€μ •ν•΄ λ΄…μ‹λ‹¤.
 *
 * - `List<Product> findAll();`
 *
 * - μ„ λ©”μ„λ“λ” 'μƒν’ λ©λ΅'μ„ ν‘μ‹ν•κΈ° μ„ν•΄ νΈμ¶λμ§€λ§, λ©λ΅μ—λ” λ‹¨μ§€ 'μ΄λ¦„'κ³Ό 'κ°€κ²©'λ§ ν•„μ”ν•  μ μμµλ‹λ‹¤.
 * - ν•μ§€λ§ JPAλ” `SELECT * ...` (μ •ν™•νλ” `SELECT p FROM Product p...`)λ¥Ό μ‹¤ν–‰ν•μ—¬ 20κ° ν•„λ“λ¥Ό 'μ „λ¶€' DBμ—μ„ μ΅°νν•κ³ , 'μ „λ¶€' μμ†μ„± μ»¨ν…μ¤νΈμ— λ΅λ“ν•©λ‹λ‹¤.
 *
 * - [λ‚­λΉ„] μ΄κ²ƒμ„ 'κ³Όλ‹¤ μ΅°ν(Over-fetching)'λΌκ³  λ¶€λ¦…λ‹λ‹¤.
 * - (1) DB-μ• ν”λ¦¬μΌ€μ΄μ… κ°„ 'λ„¤νΈμ›ν¬ λ€μ—­ν­' λ‚­λΉ„
 * - (2) μ• ν”λ¦¬μΌ€μ΄μ… 'λ©”λ¨λ¦¬(Heap)' λ‚­λΉ„
 * - (3) JPAκ°€ λ¶ν•„μ”ν• ν•„λ“κΉμ§€ λ§¤ν•‘ν•κ³  μ¤λƒ…μƒ·μ„ λ§λ“λ” 'CPU' λ‚­λΉ„
 *
 * -------------------------------------------------------------------------------------
 *
 * 2. π’΅ ν”„λ΅μ μ…: ν•„μ”ν• κ²ƒλ§ κ³¨λΌ λ‹΄κΈ°
 *
 * - [ν•΄κ²°] ν”„λ΅μ μ…μ€ DBμ `SELECT` μ μ„ μ§μ ‘ μ μ–΄ν•λ” κΈ°μ μ…λ‹λ‹¤.
 * `SELECT *` λ€μ‹  `SELECT product_id, product_name FROM product`λ¥Ό μ‹¤ν–‰ν•κ² ν•©λ‹λ‹¤.
 *
 * - 'μΈν„°νμ΄μ¤ κΈ°λ° ν”„λ΅μ μ…'μ€ Spring Data JPAκ°€ μ κ³µν•λ” κ°€μ¥ μ„Έλ ¨λ λ°©μ‹μ…λ‹λ‹¤.
 *
 * -------------------------------------------------------------------------------------
 *
 * 3. β™οΈ λ™μ‘ μ›λ¦¬ (μµμ ν™”λ μΏΌλ¦¬ + ν”„λ΅μ‹)
 *
 * - (1) Repository μ„ μ–Έ:
 * `List<ProductSummary> findByPriceGreaterThan(int price);`
 *
 * - (2) μΏΌλ¦¬ μλ™ μƒμ„± (ν•µμ‹¬):
 * Spring Data JPAλ” λ°ν™ νƒ€μ…μ΄ 'μ—”ν‹°ν‹°(`Product`)'κ°€ μ•„λ‹ 'μΈν„°νμ΄μ¤(`ProductSummary`)'
 * μΈ κ²ƒμ„ μΈμ§€ν•©λ‹λ‹¤.
 *
 * κ·Έλ¦¬κ³  'μΈν„°νμ΄μ¤μ getter λ©”μ„λ“λ…'(`getProductId`, `getProductName`)μ„ λ¶„μ„ν•μ—¬,
 * `Product` μ—”ν‹°ν‹°μ `productId`, `productName` ν•„λ“λ§ μ„ νƒν•λ”
 * 'μµμ ν™”λ JPQL'μ„ 'μλ™μΌλ΅' μƒμ„±ν•©λ‹λ‹¤.
 *
 * -> JPQL: `SELECT p.productId, p.productName FROM Product p WHERE p.price > ?1`
 *
 * - (3) ν”„λ΅μ‹ κ°μ²΄ λ°ν™ (λ§¤μ° μ¤‘μ”):
 * Spring Data JPAλ” μ΅°ν κ²°κ³Ό(μ: `[1, "Laptop"]`, `[2, "Mouse"]`)λ¥Ό
 * 'Product' μ—”ν‹°ν‹° κ°μ²΄λ΅ λ³€ν™ν•μ§€ *μ•μµλ‹λ‹¤*. (μμ†μ„± μ»¨ν…μ¤νΈμ—λ„ λ„£μ§€ μ•μ)
 *
 * λ€μ‹ , μ΄ μ΅°ν κ²°κ³Όλ¥Ό 'μ¦‰μ‹' `ProductSummary` μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•λ”
 * 'κ°€μ§ ν”„λ΅μ‹(Proxy) κ°μ²΄'μ— λ‹΄μ•„μ„ λ°ν™ν•©λ‹λ‹¤.
 *
 * - (4) μ‚¬μ©:
 * List<ProductSummary> summaries = ...;
 * String name = summaries.get(0).getProductName(); // "Laptop" (ν”„λ΅μ‹κ°€ κ°’ λ°ν™)
 *
 * -------------------------------------------------------------------------------------
 *
 * 4. β οΈ κ·μΉ™: getter λ©”μ„λ“λ…μ€ μ—”ν‹°ν‹° ν•„λ“λ…κ³Ό 'μ •ν™•ν' μΌμΉν•΄μ•Ό ν•λ‹¤
 *
 * - `getProductId()` -> `Product` μ—”ν‹°ν‹°μ `private Integer productId;` ν•„λ“
 * - `getProductName()` -> `Product` μ—”ν‹°ν‹°μ `private String productName;` ν•„λ“
 *
 * - λ§μ•½ μ¤νƒ€(μ: `getProductNamee()`)λ¥Ό λ‚΄λ©΄,
 * Spring Data JPAκ°€ λ¶€νΈ μ‹μ μ— "Property `productNamee` not found for type `Product`"
 * λΌλ” μ¤λ¥λ¥Ό λ‚΄λ©° μ‹¤ν–‰μ„ 'μ‹¤ν¨'μ‹ν‚µλ‹λ‹¤. (Fail-Fast)
 *
 * - [μ°Έκ³ ] ν΄λμ¤ κΈ°λ° ν”„λ΅μ μ… (Class-Based Projection)
 * - μΈν„°νμ΄μ¤ λ€μ‹ , `ProductSummaryDto`λΌλ” 'ν΄λμ¤'λ¥Ό λ§λ“¤μ–΄μ„ μ‚¬μ©ν•  μλ„ μμµλ‹λ‹¤.
 * μ΄ κ²½μ°, ν΄λμ¤λ” ν•„λ“, μƒμ„±μ, getterλ¥Ό κ°€μ Έμ•Ό ν•©λ‹λ‹¤.
 * - μΈν„°νμ΄μ¤ λ°©μ‹μ€ 'μ½κΈ° μ „μ©' λ°μ΄ν„°λ¥Ό κ°€μ Έμ¬ λ• λ” κ°„λ‹¨ν•κ³  κ°€λ³μµλ‹λ‹¤.
 */
public interface ProductSummary {
    Integer getProductId();
    String getProductName();
}
